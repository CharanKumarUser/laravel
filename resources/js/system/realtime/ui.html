<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRM - Scan And Go Attendance</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- QR Code Styling CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
    <!-- Icons (Font Awesome for clocks, etc.) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- Custom Styles -->
    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            text-align: center;
        }
        .qr-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }
        .qr-highlight {
            border: 4px solid #00b4af;
            border-radius: 12px;
            padding: 10px;
            display: inline-block;
            box-shadow: 0 0 20px rgba(0, 180, 175, 0.3);
        }
        .qr-canvas-wrapper {
            position: relative;
            width: 300px;
            height: 300px;
            overflow: hidden;
            background: #fff;
            border-radius: 8px;
            margin: 0 auto;
        }
        .qr-canvas-wrapper::before {
            content: "";
            position: absolute;
            inset: 0;
            background: #fff;
            clip-path: polygon(
                calc(50% - calc(var(--progress,0) * 50%)) calc(50% - calc(var(--progress,0) * 50%)),
                calc(50% + calc(var(--progress,0) * 50%)) calc(50% - calc(var(--progress,0) * 50%)),
                calc(50% + calc(var(--progress,0) * 50%)) calc(50% + calc(var(--progress,0) * 50%)),
                calc(50% - calc(var(--progress,0) * 50%)) calc(50% + calc(var(--progress,0) * 50%))
            );
            transition: clip-path 0s linear;
            z-index: 2;
            pointer-events: none;
        }
        .qr-canvas-wrapper.waiting::after {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(0, 180, 175, 0.06);
            animation: pulse 1.5s ease-in-out infinite;
            z-index: 1;
            pointer-events: none;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.2; }
        }
        .qr-canvas-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            z-index: 1;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card i {
            font-size: 2rem;
            color: #00b4af;
            margin-bottom: 10px;
        }
        .stat-card h5 {
            margin-bottom: 5px;
            color: #333;
        }
        .stat-card p {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
            color: #007bff;
        }
        .recent-activity {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 30px;
        }
        .recent-activity table {
            width: 100%;
            border-collapse: collapse;
        }
        .recent-activity th, .recent-activity td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        .recent-activity th {
            background-color: #f8f9fa;
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-in { background-color: #d4edda; color: #155724; }
        .status-out { background-color: #f8d7da; color: #721c24; }
        .live-time {
            font-size: 1rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Header -->
        <div class="header mb-4">
            <h1 class="mb-0">HRM Smart Attendance</h1>
            <p class="mb-0">Scan And Go - Real-Time Presence Tracking</p>
        </div>

        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="#">Attendance</a></li>
                <li class="breadcrumb-item active" aria-current="page">Scan And Go</li>
            </ol>
        </nav>

        <!-- QR Code Section -->
        <div class="qr-section">
            <h3 class="mb-3">Scan QR Code to Mark Attendance</h3>
            <p class="text-muted mb-4">Use your mobile device or scanner app to check in/out instantly.</p>
            <div class="qr-highlight">
                <div data-render-qr data-company-id="COMW1PDN"></div>
            </div>
            <div class="mt-3">
                <small class="text-muted">QR Code refreshes every 3 seconds for security</small>
            </div>
            <!-- Live Server Time -->
            <div class="mt-3 live-time-container">
                <i class="fa-thin fa-clock me-2"></i>
                <span class="live-time" id="live-time">Loading time...</span>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h5>Total Employees</h5>
                <p>1,250</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <h5>Present Today</h5>
                <p>1,180</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <h5>Avg Check-In Time</h5>
                <p>8:45 AM</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-map-marker-alt"></i>
                <h5>Active Locations</h5>
                <p>12</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-user-clock"></i>
                <h5>Last Login (You)</h5>
                <p>9:02 AM</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-exclamation-triangle"></i>
                <h5>Late Arrivals Today</h5>
                <p>23</p>
            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- QR Code Script -->
    <script>
        // QR State
        const qrState = new Map();

        // Create QR with reveal animation
        const createQrWithReveal = (container) => {
            const wrapper = document.createElement('div');
            wrapper.className = 'qr-canvas-wrapper waiting';
            container.appendChild(wrapper);

            const qr = new QRCodeStyling({
                width: 300,
                height: 300,
                data: "https://example-hrm.com/attendance?token=demo-12345", // Demo token
                image: "https://via.placeholder.com/60?text=LOGO", // Placeholder logo
                dotsOptions: { color: "#00b4af", type: "rounded" },
                backgroundOptions: { color: "#ffffff" },
                imageOptions: { crossOrigin: "anonymous", margin: 10, imageSize: 0.2 },
            });

            let rafId = null;
            const startReveal = (onComplete) => {
                let progress = 0;
                const duration = 800;
                const startTime = performance.now();
                const step = (now) => {
                    const elapsed = now - startTime;
                    progress = Math.min(elapsed / duration, 1);
                    wrapper.style.setProperty('--progress', progress);

                    if (progress >= 1) {
                        wrapper.classList.remove('waiting');
                        wrapper.style.removeProperty('overflow');
                        const canvas = wrapper.querySelector('canvas');
                        if (!canvas) qr.append(wrapper);
                        if (onComplete) onComplete();
                        return;
                    }
                    rafId = requestAnimationFrame(step);
                };
                rafId = requestAnimationFrame(step);
            };

            return { qr, wrapper, startReveal };
        };

        // Init QR
        const initQrDivs = () => {
            const qrDivs = document.querySelectorAll("[data-render-qr]");
            qrDivs.forEach((div) => {
                const { qr, wrapper, startReveal } = createQrWithReveal(div);
                qrState.set(div, { qr, wrapper, startReveal });

                // Append and reveal (simulate load)
                setTimeout(() => {
                    qr.append(wrapper);
                    wrapper.style.opacity = '0';
                    startReveal(() => {
                        wrapper.style.transition = "opacity 0.3s ease";
                        wrapper.style.opacity = '1';
                    });
                }, 500);

                // Simulate QR update every 3 seconds
                setInterval(() => {
                    const newToken = "https://example-hrm.com/attendance?token=" + Math.random().toString(36).substring(7);
                    qr.update({ data: newToken });
                }, 3000);
            });
        };

        // Live Clock
        const updateLiveTime = () => {
            const now = new Date();
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            document.getElementById('live-time').textContent = now.toLocaleTimeString(undefined, options);
        };

        // Load Event
        window.addEventListener("load", () => {
            initQrDivs();
            updateLiveTime();
            setInterval(updateLiveTime, 1000);
        });
    </script>
</body>
</html>